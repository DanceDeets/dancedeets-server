{% extends "_bigbox_base.html" %}

{% block title %}
Add Dance Event
{% endblock %}

{% block inner_body %}
		<form action="/events_add" method=post>
		<div>
			{% if fb_event %}
				<input type=hidden name="event_id" value="{{ fb_event.info.id }}">
				<p>Name: {{ fb_event.info.name|e }}
				<br>Description:
				<div style="padding: 20px; width: 450px; height:250px; overflow:scroll; border: 1px solid black">
				{% if fb_event.info.description %}
					{{ fb_event.info.description|format_html|linkify }}
				{% else %}
					None!
				{% endif %}
				</div>
				<p><button class="btn">Add Event</button>
			{% else %}
				Enter your facebook event URL here:<br>
				<input id="event_url_form" type=text name="event_url" size=60 onunfocus="loadEvent();">
				<br/>
				{% if events %}
					Or select one of your facebook events below:<br>
					<input id="event_id_form" type="hidden" name="event_id" value="">
					<ul id="add-events">
					{% for event in events %}
						<li data-id="{{ event.id }}" class="
							{% if event.loaded %}
								ui-disabled
							{% else %}
								ui-selectable
							{% endif %}
							">
							<div style="float:left;width:50px">
								<img src="http://graph.facebook.com/{{ event.id }}/picture" width="50">
							</div>
							<div style="float:left">
								<span class="fake-a">{{ event.name|e }}</span><br>
								<div class="non-a">
								{{ event.start_time|parse_fb_timestamp|date_human_format }}<br>
								{% if event.host %}
									(by {{ event.host }})<br>
								{% endif %}

								{% if event.loaded %}
									ALREADY ADDED
								{% endif %}
								</div>
							</div>
							<div style="clear:both;height:15px;"></div>
						</li>
					{% endfor %}
					</ul>
				{% endif %}
				<p><button class="btn" onclick="return validateAdd();">Add Event</button>
			{% endif %}
		</div>
		</form>
{% endblock %}

{% block bottom_javascript %}
<script type="text/javascript">
	function loadEvent() {
		//event_url
	}
	$(document).ready(function() {
		$("#add-events").click(function(event) {
			var selectees = $(".ui-selectable", "#add-events");
			selectees.filter('.ui-selected').each(function() {
				$(this).removeClass('ui-selected');
			});
			$(event.target).parents().andSelf().filter('.ui-selectable').each(function() {
				$(this).addClass('ui-selected');
				$('#event_id_form').val($(this).data('id'));
			});
		});
	});
	function validateAdd() {
		if ($('#event_id_form').val() || $('#event_url_form').val()) {
			return true;
		} else {
			alert("Please select one of your events to add, or enter the URL of the event you wish to add.");
			return false;
		}
	}
</script>
{% endblock %}
