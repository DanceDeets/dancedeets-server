<html>
<head>
<title>$title()</title>
<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
<style type="text/css">
body {
  font-family: Verdana, Geneva, sans-serif;
} 
#main {
  position: relative;
  width: 1000px;
}
#footer {
  clear: both;
}
* html #footer {
  height: 1px;
}
</style>
$head_stylesheet()
$head_javascript()
#if $prod_mode
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-18831479-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
#end if
</head>
<body>
## get rid of this and merge it inline?

<div id="main">
<div id="header">
	<table><tr><td>
	<a href="/"><img src="/dancedeets.png" width=374 height=71></a>
	</td><td>
	<h1>$title()</h1>
	</td></tr></table>

#if $messages
<div style="text-align: center">
#for $message in $messages
<span style="background-color: #2AA5CD; color: #CDF3FF">$message</span><br>
#end for
</div>
#end if

</div>

<div style="position: absolute; right:0px; top:0px; padding: 5px; text-align: right">
#if $fb_user
	$fb_user.profile.name
	|
	<a href="/user/edit">Settings</a>
	|
	<a href="#" onclick="FB.logout(function(response) { window.location.reload(); })">Logout</a>
#else
	<fb:login-button onlogin="window.location.reload();" perms="user_location,rsvp_event,offline_access,email,user_events"></fb:login-button>
#end if
</div>

$body()

<div id="footer" style="margin: 10px; text-align:center">
<a href="/about">About</a> | <a href="/rankings">Rankings</a> | <a href="/help">Help</a> | <a href="/feedback">Feedback</a>
<br>
<iframe src="http://www.facebook.com/plugins/like.php?href=http%3A%2F%2Fwww.facebook.com%2Fpages%2FDance-Deets%2F110312662362915&amp;layout=standard&amp;show_faces=true&amp;width=400&amp;action=recommend&amp;font=verdana&amp;colorscheme=light&amp;height=80" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:400px; height:80px;" allowTransparency="true"></iframe>
</div>
</div>

<div id="fb-root"></div>
</body>

<script src="http://www.google.com/jsapi" type="text/javascript"></script>
<script type="text/javascript">
  google.load("jquery", "1.4.2");
  google.load("jqueryui", "1.8.1");
</script>
<script>
  window.fbAsyncInit = function() {
    // Override cookie-expiration setting so we get long-lived cookies.
    original_setRaw = FB.Cookie.setRaw;
    FB.Cookie.setRaw = function(val, ts, domain) {
      // ts may be 0, so we need to fix that up here:
      if (!ts) {
        ts = ((new Date()).getTime() / 1000) + 14 * 24 * 60 * 60;
      }
      return original_setRaw(val, ts, domain);
    }
    FB.Cookie.clear = function() {
      FB.Cookie.setRaw('', 1, FB.Cookie._domain);
    }

    FB.init({appId: '$api_key', status: true, cookie: true,
             xfbml: true});
    #if not $fb_user
      ## only subscribe to login-status notifications if we're logged out, otherwise we get in an infinite loop
      FB.Event.subscribe('FB.loginStatus', getLoginStatus);
    #end if
    $fb_async_code()
  };
  (function() {
    var e = document.createElement('script'); e.async = true;
    e.src = document.location.protocol +
      '//connect.facebook.net/en_US/all.js';
    document.getElementById('fb-root').appendChild(e);
  }());

  function getLoginStatus(response) {
    if (response.session) {
      window.location.reload();
    }
  }
</script>

$bottom_javascript()

</html>

#def title
#end def
#def head_stylesheet
#end def
#def head_javascript
#end def
#def header
#end def
#def body
#end def
#def bottom_javascript
#end def
#def fb_async_code
#end def
