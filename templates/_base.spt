<html>
<head>
<title>$title()</title>
<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
<style type="text/css">
body {
  font-family: Verdana, Geneva, sans-serif;
} 
</style>
$head_stylesheet()
$head_javascript()

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-18831479-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>
<body>
## get rid of this and merge it inline?
$header()
<div style="position: absolute; right:0px; top:0px; padding: 5px; text-align: right">
#if $fb_user
	$fb_user.profile.name : <a href="/user/edit">Settings</a>
#else
	<fb:login-button onlogin="window.location.reload();" perms="user_location,rsvp_event,offline_access,email,user_events"></fb:login-button>
#end if
</div>
	<table><tr><td>
	<a href="/"><img src="/dancedeets.png" width=224 height=110></a>
	</td><td>
	<h1>$title()</h1>
	</td></tr></table>

#if $messages
<div style="text-align: center">
#for $message in $messages
<span style="background-color: #2AA5CD; color: #CDF3FF">$message</span><br>
#end for
</div>
#end if

$body()

<div style="margin: 10px">Want to help DanceDeets?
<ul>
<li>Add a <a href="/events/add">new dance event</a> to promote it.
<li>Check out how <a href="/rankings">your city's dance scene</a> is doing compared to others in DanceDeets.
<li><a href="javascript:share_dancedeets();return false">Post about DanceDeets on Facebook</a> to let your friends know about it. You know, the friends that never can quite keep up with what dance things are going on.
<li><a href="mailto:mlambert@gmail.com">Send feedback!</a> Things not working? Have ideas to make things better? Adoring fan mail?
<li>Recommend DanceDeets on Facebook:<br>
<fb:like href="http://www.dancedeets.com" width="450" action="recommend" show_faces="false"></fb:like>
</ul>
<div style="height: 100px"></div>

<div id="fb-root"></div>
</body>

<script src="http://www.google.com/jsapi" type="text/javascript"></script>
<script type="text/javascript">
  google.load("jquery", "1.4.2");
  google.load("jqueryui", "1.8.1");
</script>
<script>
  window.fbAsyncInit = function() {
    FB.init({appId: '$api_key', status: true, cookie: true,
             xfbml: true});
    #if not $fb_user
      ## only subscribe to login-status notifications if we're logged out, otherwise we get in an infinite loop
      FB.Event.subscribe('FB.loginStatus', getLoginStatus);
    #end if
    $fb_async_code()
  };
  (function() {
    var e = document.createElement('script'); e.async = true;
    e.src = document.location.protocol +
      '//connect.facebook.net/en_US/all.js';
    document.getElementById('fb-root').appendChild(e);
  }());

  function getLoginStatus(response) {
    if (response.session) {
      window.location.reload();
    }
  }

function share_dancedeets() {
	FB.ui(
		{
			method: 'stream.publish',
			message: '',
			attachment: {
				name: 'Dance Deets',
				caption: 'Keeps you in the loop on dance events you care about!',
				description: (
					"Whether you love watching dance, " +
					"or love dancing choreography or freestyling, " +
					"whether you live in the scene for awhile, " +
					"or are even just visiting a new scene, " +
					"Dance Deets helps you keeps track of it all."
				),
				href: 'http://www.dancedeets.com/',
			},
			user_message_prompt: 'Share your thoughts about DanceDeets with your friends',
	});
}
</script>

$bottom_javascript()

</html>

#def title
#end def
#def head_stylesheet
#end def
#def head_javascript
#end def
#def header
#end def
#def body
#end def
#def bottom_javascript
#end def
#def fb_async_code
#end def
